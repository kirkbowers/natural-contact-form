// Generated by CoffeeScript 1.9.3
var extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

this.NaturalContactForm || (this.NaturalContactForm = {});

NaturalContactForm.EmailProvider = (function() {
  function EmailProvider($row1, from_server1) {
    this.$row = $row1;
    this.from_server = from_server1;
    this.$cell = this.$row.find(".placeholder");
  }

  EmailProvider.prototype.needs_saving = function() {
    this.$cell.html("<p>Please click \"Save Changes\" to configure " + this.provider + ".</p>");
    return this.$row.show();
  };

  return EmailProvider;

})();

NaturalContactForm.MailChimp = (function(superClass) {
  extend(MailChimp, superClass);

  function MailChimp($row, from_server) {
    MailChimp.__super__.constructor.call(this, $row, from_server);
  }

  MailChimp.prototype.provider = "MailChimp";

  MailChimp.prototype.display = function() {
    var admin_url, contact_form_id, settings;
    settings = this.from_server.email_list_settings;
    admin_url = this.from_server.admin_url;
    contact_form_id = this.from_server.contact_form_id;
    if (settings) {
      console.log("Settings = " + JSON.stringify(settings));
      this.$cell.html("<p>\n  <a href=\"" + admin_url + "admin.php?page=natural_contact_form_mailchimp_settings&id=" + contact_form_id + "\">\n  View/Edit settings for MailChimp.</a>\n</p>");
    } else {
      console.log("There are no settings");
      this.$cell.html("<p>\n  There are no settings for MailChimp.\n  <a href=\"" + admin_url + "admin.php?page=natural_contact_form_mailchimp_api_key&id=" + contact_form_id + "\">\n  Configure</a>\n</p>");
    }
    return this.$row.show();
  };

  return MailChimp;

})(NaturalContactForm.EmailProvider);

jQuery(document).ready(function($) {
  var $list_settings_row, $radio, display_list_settings, json, mailchimp, original_value, parsed;
  $list_settings_row = $("tr#email_list_settings");
  $radio = $("input[name=email_list_provider]");
  original_value = $("input[name=email_list_provider]:checked").val();
  json = $("#natural_contact_form_json").html();
  parsed = null;
  if (json) {
    parsed = $.parseJSON(json);
  }
  mailchimp = new NaturalContactForm.MailChimp($list_settings_row, parsed);
  display_list_settings = function(provider) {
    console.log("Provider is " + provider);
    if (provider === "MailChimp") {
      if (original_value === provider) {
        return mailchimp.display();
      } else {
        return mailchimp.needs_saving();
      }
    } else {
      return $list_settings_row.hide();
    }
  };
  display_list_settings(original_value);
  return $radio.change(function() {
    return display_list_settings($(this).val());
  });
});
